feed_uri: http://assets.axoom.cloud/mixins/expose-public.xml
name: Expose Public HTTP(S) Mixin
summary: expose service to public HTTP(S) traffic
description: This mixin exposes a single service to public HTTP(S) traffic.

mixin_parameters:
  - SERVICE_NAME

external_environment:
  required:
    - PUBLIC_DOMAIN
    - PROTOCOL
  optional:
    - SUBDOMAIN_CUSTOMER_SEPARATOR

dependencies:
  http://assets.axoom.cloud/networks/traefik-public.xml:

compose:
  - version: 3.2
    services:
      (SERVICE_NAME):
        environment:
          PUBLIC_URI: ${PROTOCOL}://(SERVICE_NAME)${SUBDOMAIN_CUSTOMER_SEPARATOR-.}${PUBLIC_DOMAIN}
          PORTAL_BASE_URI: ${PROTOCOL}://${PUBLIC_DOMAIN}
        networks:
          - traefik_public
        tags:
          traefik.enable: 'true'
          traefik.tags: public
          traefik.docker.network: traefik_public
          traefik.frontend.rule: Host:(SERVICE_NAME)${SUBDOMAIN_CUSTOMER_SEPARATOR-.}${PUBLIC_DOMAIN}
        deploy:
          tags:
            traefik.enable: 'true'
            traefik.tags: public
            traefik.docker.network: traefik_public
            traefik.frontend.rule: Host:(SERVICE_NAME)${SUBDOMAIN_CUSTOMER_SEPARATOR-.}${PUBLIC_DOMAIN}
