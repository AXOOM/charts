feed_uri: http://assets.axoom.cloud/mixins/axoom-service.xml
name: AXOOM Service Mixin
summary: runs an AXOOM Service
description: This mixin runs an (usually .NET Core-based) AXOOM Service.
homepage: https://tfs.inside-axoom.org/tfs/axoom/axoom/_git/Axoom.Platform.BaseAssets?_a=readme&fullScreen=true

mixin_parameters:
  - SERVICE_NAME
  - DOCKER_REGISTRY
  - VERSION

external_environment:
  optional:
    - LOG_LEVEL
    - ASPNETCORE_ENVIRONMENT
    - WORKER_ROLE

compose:
  - version: '3.3'
    services:
      (SERVICE_NAME):
        image: (DOCKER_REGISTRY)/services/(SERVICE_NAME):(VERSION)
        environment:
          LOGGING__FORMAT: Gelf
          LOGGING__LOGLEVEL__DEFAULT: ${LOG_LEVEL-Information}
          ASPNETCORE_ENVIRONMENT: ${ASPNETCORE_ENVIRONMENT-Production}
        deploy:
          placement:
            constraints:
              - node.role == ${WORKER_ROLE:-worker}
